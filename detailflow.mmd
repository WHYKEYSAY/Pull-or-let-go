graph TD
    subgraph "Setup"
        A["Start Game"] --> B["Choose Friend's Appearance"];
        B --> C["Name Your Friend"];
    end

    C --> D["Year 1: The New Student"];
    
    subgraph "Year 1"
        D --> E{"Event: Classmates organize a party.<br/>Question: You notice the new student is alone. Will you invite them?"};
        E -->|Choice: Go over and invite| F["Event: Midterm Exams.<br/>Question: You see your friend is stressed about exams. Will you help?"];
        E -->|Choice: Ignore them| F;

        F --> G{"Choice: Study together"};
        F --> H{"Choice: Focus on your own review"};
        G & H --> I["Bullying Event 1: Rumors<br/>Event: In the library, you overhear classmates spreading a rumor that your friend was expelled for stealing."];

        I --> I_Choice{"Question: How do you react to this situation?"};
        I_Choice -->|"Choice: Confront<br/>(Via Mini-Game 1: Make a noise to distract them)"| J["Event: End-of-term party.<br/>Question: Your friend wasn't invited. Will you ask them to go with you?"];
        I_Choice -->|Choice: Pretend you didn't see and walk away| J;
        I_Choice -->|Choice: Join the gossip| J;

        J --> K{"Choice: Invite them"};
        J --> L{"Choice: Don't meddle"};
        K & L --> M["Begin Year 2"];
    end

    subgraph "Year 2"
        M --> N{"Event: Club Week.<br/>Question: Your friend invites you to join the woodworking club. Do you agree?"};
        N -->|Choice: Agree| O["Bullying Event 2: Shoving<br/>Event: You see classmates shoving your friend by the lockers, mocking them for imitating someone."];
        N -->|Choice: Decline, choose the film club| O;

        O --> O_Choice{"Question: How do you respond?"};
        O_Choice -->|"Choice: Intervene<br/>(Via Mini-Game 2: Get the dean to break it up)"| P["Event: Birthday Party.<br/>Question: Your friend is once again not invited to a popular kid's party. Do you invite them?"];
        O_Choice -->|Choice: Pretend you didn't see| P;
        O_Choice -->|Choice: Join the mocking| P;
        
        P --> Q{"Choice: Invite them"};
        P --> R{"Choice: Don't meddle"};
        Q & R --> S["Begin Year 3"];
    end

    subgraph "Year 3"
        S --> T{"Event: New Classrooms.<br/>Question: Both you and your friend are lost in the new building. Do you find the classroom together?"};
        T -->|Choice: Find it together| U["Bullying Event 3: Physical Attack<br/>Event: In an alley, you see your friend being cornered while bullies throw things at them."];
        T -->|Choice: Ask someone else on your own| U;

        U --> U_Choice{"Question: How do you help them?"};
        U_Choice -->|"Choice: Intervene<br/>(Via Mini-Game 3: Call the police and use a siren sound to scare bullies away)"| V["Event: Volunteer Opportunity.<br/>Question: You get a great volunteer opportunity and can bring one classmate. Do you invite your friend?"];
        U_Choice -->|Choice: Flee out of fear| V;
        U_Choice -->|Choice: Join the bullying and stick gum in their hair| V;

        V --> W{"Choice: Invite your friend"};
        V --> X{"Choice: Invite a more 'capable' classmate"};
        W & X --> Y["Begin Year 4"];
    end

    subgraph "Year 4 & Graduation"
        Y --> Z{"Event: University Visit.<br/>Question: On the bus to the university, your friend is sitting alone. Do you go sit with them?"};
        Z -->|Choice: Sit together| AA["Event: Capstone Project.<br/>Question: The final project for university admission can be done in teams. Do you ask your friend to partner up?"];
        Z -->|Choice: Sit with other friends| AA;

        AA -->|Choice: Ask to team up| BB["Event: Graduation Ceremony.<br/>Question: Bullies are waiting to see your friend be humiliated. Do you go pick out outfits with them?"];
        AA -->|Choice: Work alone or with a more talented student| BB;

        BB -->|Choice: Pick out outfits together| CC["Calculate Ending"];
        BB -->|Choice: Focus only on your own preparations| CC;
    end

    subgraph "Endings"
        CC["Calculate Final Ending<br/>based on Friendship Level & Bullying Event Choices"] --> E1["Ending 1: Dreams Achieved"];
        CC --> E2["Ending 2: Paths Diverged"];
        CC --> E3["Ending 3: Fading into Silence"];
        CC --> E4["Ending 4: The Turn of the Tide"];
        CC --> E5["Ending 5: Crushed by Pressure"];
        CC --> E6["Ending 6: A Tragic Loss"];
        CC --> E7["Ending 7: Breaking Free"];
    end

    subgraph "Post-Game"
        E1 & E2 & E3 & E4 & E5 & E6 & E7 --> F1["View Summary & Achievements"];
        F1 -->|Play Again| A;
    end
